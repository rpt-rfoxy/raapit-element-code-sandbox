{"version":3,"file":"1-prepare-for-eval.js","names":["readFileSync","dirname","extname","createCustomDebug","buildOptions","EventEmitter","getFileIdx","loadBabelOptions","withLinariaMetadata","ModuleQueue","getMatchedRule","parseFile","getKey","plugin","Array","isArray","key","hasKeyInList","list","pluginKey","some","i","includes","runPreevalStage","babel","item","originalAst","pluginOptions","eventEmitter","babelOptions","parseConfig","preShakePlugins","plugins","filter","highPriorityPlugins","require","resolve","transformConfig","envName","result","transformFromAstSync","code","ast","program","Error","prepareCode","evaluator","name","filename","only","log","onPreevalFinished","pair","method","preevalStageResult","length","metadata","evaluatorConfig","onlyExports","features","onEvaluatorFinished","imports","processQueueItem","cache","undefined","onParseFinished","originalASTCache","get","set","onlyAsStr","join","preparedCode","isEqual","a","b","sort","every","index","createEntrypoint","maybeCode","options","finishEvent","extension","extensions","action","rules","paths","default","inputSourceMap","root","sourceFileName","sourceMaps","fullParserOptions","processImports","queue","parent","resolvedImports","importedFile","importsOnly","resolved","entrypoint","resolveCacheKey","resolveCached","resolveCache","importsOnlySet","Set","cachedOnly","split","forEach","token","add","next","enqueue","stack","processEntrypoint","nextItem","invalidateIfChanged","cached","codeCache","mergedOnly","from","evalCache","delete","processed","prepareForEvalSync","partialEntrypoint","dummy","isEmpty","dequeue","processResult","listOfImports","entries","onResolveFinished","map","err","single","type","file","what","prepareForEval","Promise","all"],"sources":["../../src/transform-stages/1-prepare-for-eval.ts"],"sourcesContent":["/* eslint-disable no-restricted-syntax,no-continue,no-await-in-loop */\nimport { readFileSync } from 'fs';\nimport { dirname, extname } from 'path';\n\nimport type {\n  BabelFileMetadata,\n  BabelFileResult,\n  PluginItem,\n} from '@babel/core';\nimport type { File } from '@babel/types';\n\nimport type { CustomDebug } from '@linaria/logger';\nimport { createCustomDebug } from '@linaria/logger';\nimport type { Evaluator, EvaluatorConfig, StrictOptions } from '@linaria/utils';\nimport {\n  buildOptions,\n  EventEmitter,\n  getFileIdx,\n  loadBabelOptions,\n} from '@linaria/utils';\n\nimport type { Core } from '../babel';\nimport type { TransformCacheCollection } from '../cache';\nimport type Module from '../module';\nimport type { ITransformFileResult, Options } from '../types';\nimport withLinariaMetadata from '../utils/withLinariaMetadata';\n\nimport type { IEntrypoint, NextItem } from './helpers/ModuleQueue';\nimport { ModuleQueue } from './helpers/ModuleQueue';\nimport { getMatchedRule, parseFile } from './helpers/parseFile';\n\nconst getKey = (plugin: PluginItem): string | null => {\n  if (typeof plugin === 'string') {\n    return plugin;\n  }\n\n  if (Array.isArray(plugin)) {\n    return getKey(plugin[0]);\n  }\n\n  if (typeof plugin === 'object' && plugin !== null && 'key' in plugin) {\n    return (plugin as { key?: string | null }).key ?? null;\n  }\n\n  return null;\n};\n\nconst hasKeyInList = (plugin: PluginItem, list: string[]): boolean => {\n  const pluginKey = getKey(plugin);\n  return pluginKey ? list.some((i) => pluginKey.includes(i)) : false;\n};\n\nfunction runPreevalStage(\n  babel: Core,\n  item: IEntrypoint,\n  originalAst: File,\n  pluginOptions: StrictOptions,\n  eventEmitter: EventEmitter\n): BabelFileResult {\n  const babelOptions = item.parseConfig;\n\n  const preShakePlugins =\n    babelOptions.plugins?.filter((i) =>\n      hasKeyInList(i, pluginOptions.highPriorityPlugins)\n    ) ?? [];\n\n  const plugins = [\n    ...preShakePlugins,\n    [require.resolve('../plugins/preeval'), { ...pluginOptions, eventEmitter }],\n    ...(babelOptions.plugins ?? []).filter(\n      (i) => !hasKeyInList(i, pluginOptions.highPriorityPlugins)\n    ),\n  ];\n\n  const transformConfig = buildOptions({\n    ...babelOptions,\n    envName: 'linaria',\n    plugins,\n  });\n\n  const result = babel.transformFromAstSync(\n    originalAst,\n    item.code,\n    transformConfig\n  );\n\n  if (!result || !result.ast?.program) {\n    throw new Error('Babel transform failed');\n  }\n\n  return result;\n}\n\nexport function prepareCode(\n  babel: Core,\n  item: IEntrypoint,\n  originalAst: File,\n  pluginOptions: StrictOptions,\n  eventEmitter: EventEmitter\n): [code: string, imports: Module['imports'], metadata?: BabelFileMetadata] {\n  const { evaluator, name: filename, parseConfig, only } = item;\n\n  const log = createCustomDebug('transform', getFileIdx(filename));\n\n  const onPreevalFinished = eventEmitter.pair({ method: 'preeval' });\n  const preevalStageResult = runPreevalStage(\n    babel,\n    item,\n    originalAst,\n    pluginOptions,\n    eventEmitter\n  );\n  onPreevalFinished();\n\n  if (\n    only.length === 1 &&\n    only[0] === '__linariaPreval' &&\n    !withLinariaMetadata(preevalStageResult.metadata)\n  ) {\n    log('stage-1:evaluator:end', 'no metadata');\n    return [preevalStageResult.code!, null, preevalStageResult.metadata];\n  }\n\n  log('stage-1:preeval', 'metadata %O', preevalStageResult.metadata);\n  log('stage-1:evaluator:start', 'using %s', evaluator.name);\n\n  const evaluatorConfig: EvaluatorConfig = {\n    onlyExports: only,\n    highPriorityPlugins: pluginOptions.highPriorityPlugins,\n    features: pluginOptions.features,\n  };\n\n  const onEvaluatorFinished = eventEmitter.pair({ method: 'evaluator' });\n  const [, code, imports] = evaluator(\n    parseConfig,\n    preevalStageResult.ast!,\n    preevalStageResult.code!,\n    evaluatorConfig,\n    babel\n  );\n  onEvaluatorFinished();\n\n  log('stage-1:evaluator:end', '');\n\n  return [code, imports, preevalStageResult.metadata];\n}\n\nfunction processQueueItem(\n  babel: Core,\n  item: IEntrypoint | null,\n  cache: TransformCacheCollection,\n  pluginOptions: StrictOptions,\n  eventEmitter: EventEmitter\n):\n  | {\n      imports: Map<string, string[]> | null;\n      name: string;\n      result: ITransformFileResult;\n    }\n  | undefined {\n  if (!item) {\n    return undefined;\n  }\n\n  const { parseConfig, name, only, code } = item;\n\n  const onParseFinished = eventEmitter.pair({ method: 'parseFile' });\n  const ast: File =\n    cache.originalASTCache.get(name) ??\n    parseFile(babel, name, code, parseConfig);\n  onParseFinished();\n\n  const log = createCustomDebug('transform', getFileIdx(name));\n\n  cache.originalASTCache.set(name, ast);\n\n  const onlyAsStr = only.join(', ');\n  log('stage-1', `>> (${onlyAsStr})`);\n\n  const [preparedCode, imports, metadata] = prepareCode(\n    babel,\n    item,\n    ast,\n    pluginOptions,\n    eventEmitter\n  );\n\n  if (code === preparedCode) {\n    log('stage-1', `<< (${onlyAsStr})\\n === no changes ===`);\n  } else {\n    log('stage-1', `<< (${onlyAsStr})\\n${preparedCode}`);\n  }\n\n  if (preparedCode === '') return undefined;\n\n  return {\n    imports,\n    name,\n    result: {\n      code: preparedCode,\n      metadata,\n    },\n  };\n}\n\nconst isEqual = ([...a]: string[], [...b]: string[]) => {\n  if (a.includes('*')) return true;\n  if (a.length !== b.length) return false;\n  a.sort();\n  b.sort();\n  return a.every((item, index) => item === b[index]);\n};\n\nexport function createEntrypoint(\n  babel: Core,\n  name: string,\n  only: string[],\n  maybeCode: string | undefined,\n  pluginOptions: StrictOptions,\n  options: Pick<Options, 'root' | 'inputSourceMap'>,\n  eventEmitter: EventEmitter\n): IEntrypoint | 'ignored' {\n  const finishEvent = eventEmitter.pair({ method: 'createEntrypoint' });\n\n  const log = createCustomDebug('transform', getFileIdx(name));\n  const extension = extname(name);\n\n  if (!pluginOptions.extensions.includes(extension)) {\n    log(\n      'createEntrypoint',\n      `${name} is ignored. If you want it to be processed, you should add '${extension}' to the \"extensions\" option.`\n    );\n\n    finishEvent();\n    return 'ignored';\n  }\n\n  const code = maybeCode ?? readFileSync(name, 'utf-8');\n\n  const { action, babelOptions } = getMatchedRule(\n    pluginOptions.rules,\n    name,\n    code\n  );\n\n  if (action === 'ignore') {\n    log('createEntrypoint', `${name} is ignored by rule`);\n    finishEvent();\n    return 'ignored';\n  }\n\n  const evaluator: Evaluator =\n    typeof action === 'function'\n      ? action\n      : require(require.resolve(action, {\n          paths: [dirname(name)],\n        })).default;\n\n  const parseConfig = buildOptions(pluginOptions?.babelOptions, babelOptions, {\n    ast: true,\n    filename: name,\n    inputSourceMap: options.inputSourceMap,\n    root: options.root,\n    sourceFileName: name,\n    sourceMaps: true,\n  });\n\n  const fullParserOptions = loadBabelOptions(babel, name, parseConfig);\n\n  log('createEntrypoint', `${name} (${only.join(', ')})\\n${code}`);\n\n  finishEvent();\n  return {\n    code,\n    evaluator,\n    name,\n    only,\n    parseConfig: fullParserOptions,\n  };\n}\n\nfunction processImports(\n  babel: Core,\n  log: CustomDebug,\n  cache: TransformCacheCollection,\n  queue: ModuleQueue,\n  pluginOptions: StrictOptions,\n  options: Pick<Options, 'root' | 'inputSourceMap'>,\n  parent: NextItem,\n  resolvedImports: {\n    importsOnly: string[];\n    importedFile: string;\n    resolved: string | null;\n  }[],\n  eventEmitter: EventEmitter\n) {\n  for (const { importedFile, importsOnly, resolved } of resolvedImports) {\n    if (resolved === null) {\n      log(\n        'stage-1:resolve',\n        `✅ %s in %s is ignored`,\n        importedFile,\n        parent.entrypoint.name\n      );\n      continue;\n    }\n\n    const resolveCacheKey = `${parent.entrypoint.name} -> ${importedFile}`;\n    const resolveCached = cache.resolveCache.get(resolveCacheKey);\n    const importsOnlySet = new Set(importsOnly);\n    if (resolveCached) {\n      const [, cachedOnly] = resolveCached.split('\\0');\n      cachedOnly?.split(',').forEach((token) => {\n        importsOnlySet.add(token);\n      });\n    }\n\n    cache.resolveCache.set(\n      resolveCacheKey,\n      `${resolved}\\0${[...importsOnlySet].join(',')}`\n    );\n\n    const next = createEntrypoint(\n      babel,\n      resolved,\n      [...importsOnlySet],\n      undefined,\n      pluginOptions,\n      options,\n      eventEmitter\n    );\n    if (next === 'ignored') {\n      continue;\n    }\n\n    queue.enqueue([next, [parent.entrypoint.name, ...parent.stack]]);\n  }\n}\n\n// FIXME: naming\nfunction processEntrypoint(\n  babel: Core,\n  log: CustomDebug,\n  cache: TransformCacheCollection,\n  pluginOptions: StrictOptions,\n  options: Pick<Options, 'root' | 'inputSourceMap'>,\n  nextItem: NextItem,\n  eventEmitter: EventEmitter\n):\n  | {\n      imports: Map<string, string[]> | null;\n      result: ITransformFileResult;\n      only: string[];\n    }\n  | 'skip' {\n  const { code, name, only } = nextItem.entrypoint;\n\n  cache.invalidateIfChanged(name, code);\n\n  const cached = cache.codeCache.get(name);\n  // If we already have a result for this file, we should get a result for merged `only`\n  const mergedOnly = cached?.only\n    ? Array.from(new Set([...cached.only, ...only]))\n    : only;\n\n  let imports: Map<string, string[]> | null = null;\n  let result: ITransformFileResult | undefined;\n\n  if (cached) {\n    if (isEqual(cached.only, mergedOnly)) {\n      log('stage-1', '%s is already processed', name);\n      if (!nextItem.stack.includes(nextItem.entrypoint.name)) {\n        imports = cached.imports;\n      }\n\n      result = cached.result;\n    } else {\n      log(\n        'stage-1',\n        '%s is already processed, but with different `only` %o (the cached one %o)',\n        name,\n        only,\n        cached?.only\n      );\n\n      // If we already have a result for this file, we should invalidate it\n      cache.evalCache.delete(name);\n    }\n  }\n\n  if (!result) {\n    const processed = processQueueItem(\n      babel,\n      {\n        ...nextItem.entrypoint,\n        only: mergedOnly,\n      },\n      cache,\n      pluginOptions,\n      eventEmitter\n    );\n\n    if (!processed) {\n      log('stage-1', '%s is skipped', name);\n      return 'skip';\n    }\n\n    imports = processed.imports;\n    result = processed.result;\n  }\n\n  return {\n    imports,\n    result,\n    only: mergedOnly,\n  };\n}\n\nexport function prepareForEvalSync(\n  babel: Core,\n  cache: TransformCacheCollection,\n  resolve: (what: string, importer: string, stack: string[]) => string,\n  partialEntrypoint: Pick<IEntrypoint, 'code' | 'name' | 'only'>,\n  pluginOptions: StrictOptions,\n  options: Pick<Options, 'root' | 'inputSourceMap'>,\n  eventEmitter = EventEmitter.dummy\n): ITransformFileResult | undefined {\n  const log = createCustomDebug(\n    'transform',\n    getFileIdx(partialEntrypoint.name)\n  );\n\n  const entrypoint = createEntrypoint(\n    babel,\n    partialEntrypoint.name,\n    partialEntrypoint.only,\n    partialEntrypoint.code,\n    pluginOptions,\n    options,\n    eventEmitter\n  );\n\n  if (entrypoint === 'ignored') {\n    return undefined;\n  }\n\n  const queue = new ModuleQueue(entrypoint);\n\n  while (!queue.isEmpty()) {\n    const item = queue.dequeue();\n    if (!item) {\n      continue;\n    }\n\n    const processResult = processEntrypoint(\n      babel,\n      log,\n      cache,\n      pluginOptions,\n      options,\n      item,\n      eventEmitter\n    );\n    if (processResult === 'skip') {\n      continue;\n    }\n\n    const { imports, result, only: mergedOnly } = processResult;\n    const listOfImports = Array.from(imports?.entries() ?? []);\n\n    if (listOfImports.length > 0) {\n      const onResolveFinished = eventEmitter.pair({ method: 'resolve' });\n      const resolvedImports = listOfImports.map(\n        ([importedFile, importsOnly]) => {\n          let resolved: string | null = null;\n          try {\n            resolved = resolve(importedFile, item.entrypoint.name, item.stack);\n            log(\n              'stage-1:sync-resolve',\n              `✅ ${importedFile} -> ${resolved} (only: %o)`,\n              importsOnly\n            );\n          } catch (err) {\n            log(\n              'stage-1:sync-resolve',\n              `❌ cannot resolve ${importedFile}: %O`,\n              err\n            );\n          }\n\n          return {\n            importedFile,\n            importsOnly,\n            resolved,\n          };\n        }\n      );\n      onResolveFinished();\n\n      eventEmitter.single({\n        type: 'dependency',\n        file: item.entrypoint.name,\n        only: item.entrypoint.only,\n        imports: resolvedImports.map(({ resolved, importsOnly }) => ({\n          from: resolved,\n          what: importsOnly,\n        })),\n      });\n\n      processImports(\n        babel,\n        log,\n        cache,\n        queue,\n        pluginOptions,\n        options,\n        item,\n        resolvedImports,\n        eventEmitter\n      );\n    } else {\n      eventEmitter.single({\n        type: 'dependency',\n        file: item.entrypoint.name,\n        only: item.entrypoint.only,\n        imports: [],\n      });\n\n      log('stage-1', '%s has no imports', item.entrypoint.name);\n    }\n\n    cache.codeCache.set(item.entrypoint.name, {\n      imports,\n      only: mergedOnly,\n      result,\n    });\n  }\n\n  return cache.codeCache.get(entrypoint.name)?.result;\n}\n\n/**\n * Parses the specified file and recursively all its dependencies,\n * finds tags, applies eval-time replacements, removes dead code.\n */\nexport default async function prepareForEval(\n  babel: Core,\n  cache: TransformCacheCollection,\n  resolve: (\n    what: string,\n    importer: string,\n    stack: string[]\n  ) => Promise<string | null>,\n  partialEntrypoint: Pick<IEntrypoint, 'code' | 'name' | 'only'>,\n  pluginOptions: StrictOptions,\n  options: Pick<Options, 'root' | 'inputSourceMap'>,\n  eventEmitter = EventEmitter.dummy\n): Promise<ITransformFileResult | undefined> {\n  /*\n   * This method can be run simultaneously for multiple files.\n   * A shared cache is accessible for all runs, but each run has its own queue\n   * to maintain the correct processing order. The cache stores the outcome\n   * of tree-shaking, and if the result is already stored in the cache\n   * but the \"only\" option has changed, the file will be re-processed using\n   * the combined \"only\" option.\n   */\n  const log = createCustomDebug(\n    'transform',\n    getFileIdx(partialEntrypoint.name)\n  );\n\n  const entrypoint = createEntrypoint(\n    babel,\n    partialEntrypoint.name,\n    partialEntrypoint.only,\n    partialEntrypoint.code,\n    pluginOptions,\n    options,\n    eventEmitter\n  );\n\n  if (entrypoint === 'ignored') {\n    return undefined;\n  }\n\n  const queue = new ModuleQueue(entrypoint);\n\n  while (!queue.isEmpty()) {\n    const item = queue.dequeue();\n    if (!item) {\n      continue;\n    }\n\n    const processResult = processEntrypoint(\n      babel,\n      log,\n      cache,\n      pluginOptions,\n      options,\n      item,\n      eventEmitter\n    );\n    if (processResult === 'skip') {\n      continue;\n    }\n\n    const { imports, result, only: mergedOnly } = processResult;\n\n    const listOfImports = Array.from(imports?.entries() ?? []);\n    if (listOfImports.length > 0) {\n      const onResolveFinished = eventEmitter.pair({ method: 'resolve' });\n      const resolvedImports = await Promise.all(\n        listOfImports.map(async ([importedFile, importsOnly]) => {\n          let resolved: string | null = null;\n          try {\n            resolved = await resolve(\n              importedFile,\n              item.entrypoint.name,\n              item.stack\n            );\n          } catch (err) {\n            log(\n              'stage-1:async-resolve',\n              `❌ cannot resolve %s in %s: %O`,\n              importedFile,\n              item.entrypoint.name,\n              err\n            );\n          }\n\n          if (resolved !== null) {\n            log(\n              'stage-1:async-resolve',\n              `✅ %s (%o) in %s -> %s`,\n              importedFile,\n              importsOnly,\n              item.entrypoint.name,\n              resolved\n            );\n          }\n\n          return {\n            importedFile,\n            importsOnly,\n            resolved,\n          };\n        })\n      );\n      onResolveFinished();\n\n      eventEmitter.single({\n        type: 'dependency',\n        file: item.entrypoint.name,\n        only: item.entrypoint.only,\n        imports: resolvedImports.map(({ resolved, importsOnly }) => ({\n          from: resolved,\n          what: importsOnly,\n        })),\n      });\n\n      processImports(\n        babel,\n        log,\n        cache,\n        queue,\n        pluginOptions,\n        options,\n        item,\n        resolvedImports,\n        eventEmitter\n      );\n    } else {\n      eventEmitter.single({\n        type: 'dependency',\n        file: item.entrypoint.name,\n        only: item.entrypoint.only,\n        imports: [],\n      });\n\n      log('stage-1', '%s has no imports', item.entrypoint.name);\n    }\n\n    cache.codeCache.set(item.entrypoint.name, {\n      imports,\n      only: mergedOnly,\n      result,\n    });\n  }\n\n  log('stage-1', 'queue is empty, %s is ready', entrypoint.name);\n\n  return cache.codeCache.get(entrypoint.name)?.result;\n}\n"],"mappings":"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"}