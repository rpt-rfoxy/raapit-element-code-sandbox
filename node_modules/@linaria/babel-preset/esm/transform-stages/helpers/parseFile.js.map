{"version":3,"file":"parseFile.js","names":["createCustomDebug","getFileIdx","getMatchedRule","rules","filename","code","i","length","rule","test","RegExp","action","parseFile","babel","originalCode","parseConfig","log","parseResult","parseSync","Error"],"sources":["../../../src/transform-stages/helpers/parseFile.ts"],"sourcesContent":["import type { TransformOptions } from '@babel/core';\nimport type { File } from '@babel/types';\n\nimport { createCustomDebug } from '@linaria/logger';\nimport type { EvalRule } from '@linaria/utils';\nimport { getFileIdx } from '@linaria/utils';\n\nimport type { Core } from '../../babel';\n\nexport function getMatchedRule(\n  rules: EvalRule[],\n  filename: string,\n  code: string\n): EvalRule {\n  for (let i = rules.length - 1; i >= 0; i--) {\n    const rule = rules[i];\n    if (!rule.test) {\n      return rule;\n    }\n\n    if (typeof rule.test === 'function' && rule.test(filename, code)) {\n      return rule;\n    }\n\n    if (rule.test instanceof RegExp && rule.test.test(filename)) {\n      return rule;\n    }\n  }\n\n  return { action: 'ignore' };\n}\n\nexport function parseFile(\n  babel: Core,\n  filename: string,\n  originalCode: string,\n  parseConfig: TransformOptions\n): File {\n  const log = createCustomDebug('transform:parse', getFileIdx(filename));\n\n  const parseResult = babel.parseSync(originalCode, parseConfig);\n  if (!parseResult) {\n    throw new Error(`Failed to parse ${filename}`);\n  }\n\n  log('stage-1', `${filename} has been parsed`);\n\n  return parseResult;\n}\n"],"mappings":"AAGA,SAASA,iBAAiB,QAAQ,iBAAiB;AAEnD,SAASC,UAAU,QAAQ,gBAAgB;AAI3C,OAAO,SAASC,cAAcA,CAC5BC,KAAiB,EACjBC,QAAgB,EAChBC,IAAY,EACF;EACV,KAAK,IAAIC,CAAC,GAAGH,KAAK,CAACI,MAAM,GAAG,CAAC,EAAED,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;IAC1C,MAAME,IAAI,GAAGL,KAAK,CAACG,CAAC,CAAC;IACrB,IAAI,CAACE,IAAI,CAACC,IAAI,EAAE;MACd,OAAOD,IAAI;IACb;IAEA,IAAI,OAAOA,IAAI,CAACC,IAAI,KAAK,UAAU,IAAID,IAAI,CAACC,IAAI,CAACL,QAAQ,EAAEC,IAAI,CAAC,EAAE;MAChE,OAAOG,IAAI;IACb;IAEA,IAAIA,IAAI,CAACC,IAAI,YAAYC,MAAM,IAAIF,IAAI,CAACC,IAAI,CAACA,IAAI,CAACL,QAAQ,CAAC,EAAE;MAC3D,OAAOI,IAAI;IACb;EACF;EAEA,OAAO;IAAEG,MAAM,EAAE;EAAS,CAAC;AAC7B;AAEA,OAAO,SAASC,SAASA,CACvBC,KAAW,EACXT,QAAgB,EAChBU,YAAoB,EACpBC,WAA6B,EACvB;EACN,MAAMC,GAAG,GAAGhB,iBAAiB,CAAC,iBAAiB,EAAEC,UAAU,CAACG,QAAQ,CAAC,CAAC;EAEtE,MAAMa,WAAW,GAAGJ,KAAK,CAACK,SAAS,CAACJ,YAAY,EAAEC,WAAW,CAAC;EAC9D,IAAI,CAACE,WAAW,EAAE;IAChB,MAAM,IAAIE,KAAK,CAAE,mBAAkBf,QAAS,EAAC,CAAC;EAChD;EAEAY,GAAG,CAAC,SAAS,EAAG,GAAEZ,QAAS,kBAAiB,CAAC;EAE7C,OAAOa,WAAW;AACpB"}