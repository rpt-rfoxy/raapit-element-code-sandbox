{"version":3,"file":"cache.js","names":["_crypto","require","hashContent","content","createHash","update","digest","TransformCacheCollection","contentHashes","Map","constructor","resolveCache","codeCache","evalCache","originalASTCache","invalidateForFile","filename","delete","invalidateIfChanged","hash","get","newHash","set","exports"],"sources":["../src/cache.ts"],"sourcesContent":["import { createHash } from 'crypto';\n\nimport type { File } from '@babel/types';\n\nimport type Module from './module';\nimport type { ITransformFileResult } from './types';\n\nfunction hashContent(content: string) {\n  return createHash('sha256').update(content).digest('hex');\n}\n\nexport class TransformCacheCollection {\n  private contentHashes = new Map<string, string>();\n\n  constructor(\n    public readonly resolveCache: Map<string, string> = new Map(),\n    public readonly codeCache: Map<\n      string,\n      {\n        imports: Map<string, string[]> | null;\n        only: string[];\n        result: ITransformFileResult;\n      }\n    > = new Map(),\n    public readonly evalCache: Map<string, Module> = new Map(),\n    public readonly originalASTCache: Map<string, File> = new Map()\n  ) {}\n\n  public invalidateForFile(filename: string) {\n    this.resolveCache.delete(filename);\n    this.codeCache.delete(filename);\n    this.evalCache.delete(filename);\n    this.originalASTCache.delete(filename);\n  }\n\n  public invalidateIfChanged(filename: string, content: string) {\n    const hash = this.contentHashes.get(filename);\n    const newHash = hashContent(content);\n\n    if (hash !== newHash) {\n      this.contentHashes.set(filename, newHash);\n      this.invalidateForFile(filename);\n    }\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAOA,SAASC,WAAWA,CAACC,OAAe,EAAE;EACpC,OAAO,IAAAC,kBAAU,EAAC,QAAQ,CAAC,CAACC,MAAM,CAACF,OAAO,CAAC,CAACG,MAAM,CAAC,KAAK,CAAC;AAC3D;AAEO,MAAMC,wBAAwB,CAAC;EAC5BC,aAAa,GAAG,IAAIC,GAAG,CAAiB,CAAC;EAEjDC,WAAWA,CACOC,YAAiC,GAAG,IAAIF,GAAG,CAAC,CAAC,EAC7CG,SAOf,GAAG,IAAIH,GAAG,CAAC,CAAC,EACGI,SAA8B,GAAG,IAAIJ,GAAG,CAAC,CAAC,EAC1CK,gBAAmC,GAAG,IAAIL,GAAG,CAAC,CAAC,EAC/D;IAAA,KAXgBE,YAAiC,GAAjCA,YAAiC;IAAA,KACjCC,SAOf,GAPeA,SAOf;IAAA,KACeC,SAA8B,GAA9BA,SAA8B;IAAA,KAC9BC,gBAAmC,GAAnCA,gBAAmC;EAClD;EAEIC,iBAAiBA,CAACC,QAAgB,EAAE;IACzC,IAAI,CAACL,YAAY,CAACM,MAAM,CAACD,QAAQ,CAAC;IAClC,IAAI,CAACJ,SAAS,CAACK,MAAM,CAACD,QAAQ,CAAC;IAC/B,IAAI,CAACH,SAAS,CAACI,MAAM,CAACD,QAAQ,CAAC;IAC/B,IAAI,CAACF,gBAAgB,CAACG,MAAM,CAACD,QAAQ,CAAC;EACxC;EAEOE,mBAAmBA,CAACF,QAAgB,EAAEb,OAAe,EAAE;IAC5D,MAAMgB,IAAI,GAAG,IAAI,CAACX,aAAa,CAACY,GAAG,CAACJ,QAAQ,CAAC;IAC7C,MAAMK,OAAO,GAAGnB,WAAW,CAACC,OAAO,CAAC;IAEpC,IAAIgB,IAAI,KAAKE,OAAO,EAAE;MACpB,IAAI,CAACb,aAAa,CAACc,GAAG,CAACN,QAAQ,EAAEK,OAAO,CAAC;MACzC,IAAI,CAACN,iBAAiB,CAACC,QAAQ,CAAC;IAClC;EACF;AACF;AAACO,OAAA,CAAAhB,wBAAA,GAAAA,wBAAA"}