{"version":3,"file":"module.js","names":["_fs","_interopRequireDefault","require","_module","_path","_vm","_logger","_utils","_cache","process","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","DefaultModuleImplementation","NativeModule","exports","builtins","assert","buffer","child_process","cluster","console","constants","crypto","dgram","dns","domain","events","fs","http","https","module","net","os","path","punycode","querystring","readline","repl","stream","string_decoder","sys","timers","tls","tty","url","util","vm","zlib","VALUES","Symbol","isProxy","NOOP","padStart","num","len","toString","hasKey","Module","isEvaluated","lazyValues","tagProcessors","constructor","filename","options","TransformCacheCollection","debuggerDepth","parentModule","moduleImpl","idx","getFileIdx","id","imports","dependencies","transform","debug","createCustomDebug","Map","Proxy","target","values","forEach","v","k","value","_this$lazyValues$get","Reflect","undefined","_this$lazyValues$get2","defaultValue","ownKeys","Array","from","keys","descriptor","enumerable","configurable","extensions","resolve","resolveCacheKey","resolveCache","_extensions","added","ext","push","_resolveFilename","paths","_nodeModulePaths","dirname","assign","_this$dependencies","resolved","onlyList","split","isAbsolute","Error","m","evalCache","namespace","extension","extname","includes","code","codeCache","_cached$only","cached","only","filter","token","cachedOnly","Set","isMatched","every","result","_only$filter","readFileSync","test","JSON","parse","evaluate","ensure","source","context","createContext","clearImmediate","clearInterval","clearTimeout","setImmediate","setInterval","setTimeout","global","__filename","__dirname","script","Script","runInContext","e","EvalError","callstack","message","join","_default"],"sources":["../src/module.ts"],"sourcesContent":["/**\n * This is a custom implementation for the module system for evaluating code,\n * used for resolving values for dependencies interpolated in `css` or `styled`.\n *\n * This serves 2 purposes:\n * - Avoid leakage from evaluated code to module cache in current context, e.g. `babel-register`\n * - Allow us to invalidate the module cache without affecting other stuff, necessary for rebuilds\n *\n * We also use it to transpile the code with Babel by default.\n * We also store source maps for it to provide correct error stacktraces.\n *\n */\n\nimport fs from 'fs';\nimport NativeModule from 'module';\nimport path from 'path';\nimport vm from 'vm';\n\nimport type { BabelFileResult } from '@babel/core';\n\nimport type { CustomDebug } from '@linaria/logger';\nimport { createCustomDebug } from '@linaria/logger';\nimport type { BaseProcessor } from '@linaria/tags';\nimport type { StrictOptions } from '@linaria/utils';\nimport { getFileIdx } from '@linaria/utils';\n\nimport { TransformCacheCollection } from './cache';\nimport * as process from './process';\n\ntype HiddenModuleMembers = {\n  _extensions: { [key: string]: () => void };\n  _nodeModulePaths(filename: string): string[];\n  _resolveFilename: (\n    id: string,\n    options: { id: string; filename: string; paths: string[] }\n  ) => string;\n};\n\nexport const DefaultModuleImplementation = NativeModule as typeof NativeModule &\n  HiddenModuleMembers;\n\n// Supported node builtins based on the modules polyfilled by webpack\n// `true` means module is polyfilled, `false` means module is empty\nconst builtins = {\n  assert: true,\n  buffer: true,\n  child_process: false,\n  cluster: false,\n  console: true,\n  constants: true,\n  crypto: true,\n  dgram: false,\n  dns: false,\n  domain: true,\n  events: true,\n  fs: false,\n  http: true,\n  https: true,\n  module: false,\n  net: false,\n  os: true,\n  path: true,\n  punycode: true,\n  process: true,\n  querystring: true,\n  readline: false,\n  repl: false,\n  stream: true,\n  string_decoder: true,\n  sys: true,\n  timers: true,\n  tls: false,\n  tty: true,\n  url: true,\n  util: true,\n  vm: true,\n  zlib: true,\n};\n\nconst VALUES = Symbol('values');\n\nconst isProxy = (\n  obj: unknown\n): obj is { [VALUES]: Record<string | symbol, unknown> } =>\n  typeof obj === 'object' && obj !== null && VALUES in obj;\n\nconst NOOP = () => {};\n\nconst padStart = (num: number, len: number) =>\n  num.toString(10).padStart(len, '0');\n\nconst hasKey = <TKey extends string | symbol>(\n  obj: unknown,\n  key: TKey\n): obj is Record<TKey, unknown> =>\n  (typeof obj === 'object' || typeof obj === 'function') &&\n  obj !== null &&\n  key in obj;\n\nclass Module {\n  #isEvaluated = false;\n\n  #exports: Record<string, unknown> | unknown;\n\n  #lazyValues: Map<string | symbol, () => unknown>;\n\n  readonly idx: number;\n\n  id: string;\n\n  filename: string;\n\n  imports: Map<string, string[]> | null;\n\n  // paths: string[];\n\n  extensions: string[];\n\n  dependencies: string[] | null;\n\n  tagProcessors: BaseProcessor[] = [];\n\n  transform: ((text: string) => BabelFileResult | null) | null;\n\n  debug: CustomDebug;\n\n  constructor(\n    filename: string,\n    public options: Pick<StrictOptions, 'extensions'>,\n    private cache = new TransformCacheCollection(),\n    private debuggerDepth = 0,\n    private parentModule?: Module,\n    private moduleImpl: HiddenModuleMembers = DefaultModuleImplementation\n  ) {\n    this.idx = getFileIdx(filename);\n    this.id = filename;\n    this.filename = filename;\n    this.imports = null;\n    this.dependencies = null;\n    this.transform = null;\n    this.debug = createCustomDebug('module', this.idx);\n\n    this.#lazyValues = new Map();\n\n    const exports: Record<string | symbol, unknown> = {};\n\n    this.#exports = new Proxy(exports, {\n      get: (target, key) => {\n        if (key === VALUES) {\n          const values: Record<string | symbol, unknown> = {};\n          this.#lazyValues.forEach((v, k) => {\n            values[k] = v();\n          });\n\n          return values;\n        }\n        let value: unknown;\n        if (this.#lazyValues.has(key)) {\n          value = this.#lazyValues.get(key)?.();\n        } else {\n          // Support Object.prototype methods on `exports`\n          // e.g `exports.hasOwnProperty`\n          value = Reflect.get(target, key);\n        }\n\n        if (value === undefined && this.#lazyValues.has('default')) {\n          const defaultValue = this.#lazyValues.get('default')?.();\n          if (hasKey(defaultValue, key)) {\n            this.debug(\n              'evaluated',\n              '⚠️  %s has been found in `default`. It indicates that ESM to CJS conversion of %s went wrong.',\n              key,\n              filename\n            );\n            value = defaultValue[key];\n          }\n        }\n\n        this.debug('evaluated', 'get %s: %o', key, value);\n        return value;\n      },\n      has: (target, key) => {\n        if (key === VALUES) return true;\n        return this.#lazyValues.has(key);\n      },\n      ownKeys: () => {\n        return Array.from(this.#lazyValues.keys());\n      },\n      set: (target, key, value) => {\n        if (key !== '__esModule') {\n          this.debug('evaluated', 'set %s: %o', key, value);\n        }\n\n        if (value !== undefined) {\n          this.#lazyValues.set(key, () => value);\n        }\n\n        return true;\n      },\n      defineProperty: (target, key, descriptor) => {\n        const { value } = descriptor;\n        if (value !== undefined) {\n          this.#lazyValues.set(key, () => value);\n\n          if (key !== '__esModule') {\n            this.debug(\n              'evaluated',\n              'defineProperty %s with value %o',\n              key,\n              value\n            );\n          }\n\n          this.#lazyValues.set(key, () => value);\n\n          return true;\n        }\n\n        if ('get' in descriptor) {\n          this.#lazyValues.set(key, descriptor.get!);\n          this.debug('evaluated', 'defineProperty %s with getter', key);\n        }\n\n        return true;\n      },\n      getOwnPropertyDescriptor: (target, key) => {\n        if (this.#lazyValues.has(key))\n          return {\n            enumerable: true,\n            configurable: true,\n          };\n\n        return undefined;\n      },\n    });\n\n    this.extensions = options.extensions;\n    this.debug('init', filename);\n  }\n\n  public get exports() {\n    return this.#exports;\n  }\n\n  public set exports(value) {\n    if (isProxy(value)) {\n      this.#exports = value[VALUES];\n    } else {\n      this.#exports = value;\n    }\n\n    this.debug(\n      'evaluated',\n      'the whole exports was overridden with %O',\n      this.#exports\n    );\n  }\n\n  resolve = (id: string) => {\n    const resolveCacheKey = `${this.filename} -> ${id}`;\n    if (this.cache.resolveCache.has(resolveCacheKey)) {\n      return this.cache.resolveCache.get(resolveCacheKey)!;\n    }\n\n    const extensions = this.moduleImpl._extensions;\n    const added: string[] = [];\n\n    try {\n      // Check for supported extensions\n      this.extensions.forEach((ext) => {\n        if (ext in extensions) {\n          return;\n        }\n\n        // When an extension is not supported, add it\n        // And keep track of it to clean it up after resolving\n        // Use noop for the transform function since we handle it\n        extensions[ext] = NOOP;\n        added.push(ext);\n      });\n\n      const { filename } = this;\n\n      return this.moduleImpl._resolveFilename(id, {\n        id: filename,\n        filename,\n        paths: this.moduleImpl._nodeModulePaths(path.dirname(filename)),\n      });\n    } finally {\n      // Cleanup the extensions we added to restore previous behaviour\n      added.forEach((ext) => delete extensions[ext]);\n    }\n  };\n\n  require: {\n    (id: string): unknown;\n    resolve: (id: string) => string;\n    ensure: () => void;\n  } = Object.assign(\n    (id: string) => {\n      if (id in builtins) {\n        // The module is in the allowed list of builtin node modules\n        // Ideally we should prevent importing them, but webpack polyfills some\n        // So we check for the list of polyfills to determine which ones to support\n        if (builtins[id as keyof typeof builtins]) {\n          this.debug('require', `builtin '${id}'`);\n          return require(id);\n        }\n\n        return null;\n      }\n\n      // Resolve module id (and filename) relatively to parent module\n      const resolved = this.resolve(id);\n      const [filename, onlyList] = resolved.split('\\0');\n      if (filename === id && !path.isAbsolute(id)) {\n        // The module is a builtin node modules, but not in the allowed list\n        throw new Error(\n          `Unable to import \"${id}\". Importing Node builtins is not supported in the sandbox.`\n        );\n      }\n\n      this.dependencies?.push(id);\n\n      let m: Module;\n\n      this.debug('require', `${id} -> ${filename}`);\n\n      if (this.cache.evalCache.has(filename)) {\n        m = this.cache.evalCache.get(filename)!;\n        this.debug('eval-cache', '✅ %r has been gotten from cache', {\n          namespace: `module:${padStart(m.idx, 5)}`,\n        });\n      } else {\n        this.debug('eval-cache', `➕ %r is going to be initialized`, {\n          namespace: `module:${padStart(getFileIdx(filename), 5)}`,\n        });\n        // Create the module if cached module is not available\n        m = new Module(\n          filename,\n          this.options,\n          this.cache,\n          this.debuggerDepth + 1,\n          this\n        );\n        m.transform = this.transform;\n\n        // Store it in cache at this point with, otherwise\n        // we would end up in infinite loop with cyclic dependencies\n        this.cache.evalCache.set(filename, m);\n      }\n\n      const extension = path.extname(filename);\n      if (extension === '.json' || this.extensions.includes(extension)) {\n        let code: string | undefined;\n        // Requested file can be already prepared for evaluation on the stage 1\n        if (onlyList && this.cache.codeCache.has(filename)) {\n          const cached = this.cache.codeCache.get(filename);\n          const only = onlyList\n            .split(',')\n            .filter((token) => !m.#lazyValues.has(token));\n          const cachedOnly = new Set(cached?.only ?? []);\n          const isMatched =\n            cachedOnly.has('*') ||\n            (only && only.every((token) => cachedOnly.has(token)));\n          if (cached && isMatched) {\n            m.debug('code-cache', '✅');\n            code = cached.result.code;\n          } else {\n            m.debug(\n              'code-cache',\n              '%o is missing (%o were cached)',\n              only?.filter((token) => !cachedOnly.has(token)) ?? [],\n              [...cachedOnly.values()]\n            );\n          }\n        } else if (m.#isEvaluated) {\n          m.debug(\n            'code-cache',\n            '✅ not in the code cache, but is already evaluated'\n          );\n        } else {\n          // If code wasn't extracted from cache, read it from the file system\n          // TODO: transpile the file\n          m.debug(\n            'code-cache',\n            '❌ file has not been processed during prepare stage'\n          );\n          code = fs.readFileSync(filename, 'utf-8');\n        }\n\n        if (code) {\n          if (/\\.json$/.test(filename)) {\n            // For JSON files, parse it to a JS object similar to Node\n            m.exports = JSON.parse(code);\n            m.#isEvaluated = true;\n          } else {\n            // For JS/TS files, evaluate the module\n            m.evaluate(code);\n          }\n        }\n      } else {\n        // For non JS/JSON requires, just export the id\n        // This is to support importing assets in webpack\n        // The module will be resolved by css-loader\n        m.exports = filename;\n        m.#isEvaluated = true;\n      }\n\n      return m.exports;\n    },\n    {\n      ensure: NOOP,\n      resolve: this.resolve,\n    }\n  );\n\n  evaluate(source: string): void {\n    if (!source) {\n      this.debug(`evaluate`, 'there is nothing to evaluate');\n    }\n\n    if (this.#isEvaluated) {\n      this.debug('evaluate', `is already evaluated`);\n      return;\n    }\n\n    this.debug('evaluate', `\\n${source}`);\n\n    this.#isEvaluated = true;\n\n    const { filename } = this;\n\n    const context = vm.createContext({\n      clearImmediate: NOOP,\n      clearInterval: NOOP,\n      clearTimeout: NOOP,\n      setImmediate: NOOP,\n      setInterval: NOOP,\n      setTimeout: NOOP,\n      global,\n      process,\n      module: this,\n      exports: this.#exports,\n      require: this.require,\n      __filename: filename,\n      __dirname: path.dirname(filename),\n    });\n\n    try {\n      const script = new vm.Script(\n        `(function (exports) { ${source}\\n})(exports);`,\n        {\n          filename,\n        }\n      );\n\n      script.runInContext(context);\n      return;\n    } catch (e) {\n      if (e instanceof EvalError) {\n        this.debug('evaluate:error', '%O', e);\n\n        throw e;\n      }\n\n      const callstack: string[] = ['', filename];\n      let module = this.parentModule;\n      while (module) {\n        callstack.push(module.filename);\n        module = module.parentModule;\n      }\n\n      this.debug('evaluate:error', '%O\\n%O', e, callstack);\n      throw new EvalError(\n        `${(e as Error).message} in${callstack.join('\\n| ')}\\n`\n      );\n    }\n  }\n}\n\nexport default Module;\n"],"mappings":"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"}